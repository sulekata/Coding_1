---
title: "Are Best Actor Awardees More Likely to Be White?"
subtitle: "Final Term Project - Data Analysis 2"
author: "Kata SÃ¼le"
date: '3rd January 2021'
abstract: 'The aim of this analysis is to find out whether Best Actor Awardees at the Academy Awards are more likely to be white than of other colours. To investigate this question I use a data set on Best Actor Awardees between 1929 and 2014 with race being the dependent variable and explanatory variables such as place of birth, sexual orientation, elapsed years since the award ceremony and age at award ceremony. By using these variables I estimate several probability models including linear probability models, a logit model and a probit model and come to the conclusion that neither of the models have significant parameters therefore they are not suitable for prediction purposes. Lastly, I check if my results have external validity for which I use samples of the Best Supporting Actor, Best Actress and Best Director categories and find that none of the parameters are significant in any of the models. Therefore I conclude that the insignificant results are probably not due to the small sample size but to inadequate explanatory variables.'
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(message = FALSE)
```

```{r, include=FALSE}
# clean environment
rm( list=ls() )

# initialize packages
library( tidyverse )
library( fastDummies )
library( RColorBrewer )
library( kableExtra )
library( xtable )
library( lspline )
library( mfx )
library( modelsummary )
library( car )
library( pscl )
```

```{r, include=FALSE}
# call the sum_stat function
# original source: https://github.com/CEU-Economics-and-Business/ECBS-5208-Coding-1-Business-Analytics/blob/master/Class_10/codes/sum_stat_f.R

source('https://raw.githubusercontent.com/sulekata/Coding_1/master/Term_Project/codes/function_sum_stat.R')
```


```{r, include=FALSE}
# import data
github_url <- 'https://raw.githubusercontent.com/sulekata/Coding_1/master/Term_Project/data/clean/best_actor_awardees.csv'

df <- read_csv( github_url )
```

## Introduction

Discrimination has always been present in many parts of life. Probably discrimination against gender and race are the two types that make headlines most often and not so surprisingly also in connection with the [Academy Awards](https://www.standard.co.uk/insider/celebrity/only-32-actors-of-colour-have-ever-won-an-oscar-a4354751.html). In this analysis I only focused on race discrimination because I was curious to see whether the data proves the statement that Best Actor Awardees at the Academy Awards are more likely to be white.

## Data

```{r, include=FALSE}
#### exploratory data analysis

#### check missing values
# missing values are indicated with na stored as a character
missing <- df %>% filter( grepl('na', race ) | grepl( 'na', birthplace ) | grepl( 'na', sexual_orientation ) | grepl( 'na', years_since_award ) | grepl( 'na', age_at_award ) )
# there is only one observation with a missing value ( for the sexual orientation variable ) therefore I am going to drop this observation

df <- df %>% filter( !grepl( 'na', sexual_orientation ) )

#### check distributions of variables

# distribution of dependent variable - race
ggplot( data = df, aes( x = race, fill = race ) )  +
  geom_bar() +
  theme_bw() +
  labs( x = '\n Race of Awardees', y = 'Number of Awardees \n',
        title = 'Distribution of Best Actor Awardees by Race (1929-2014)') +
  theme( panel.grid.minor.x = element_blank(), 
         plot.title = element_text( size = 12, face = "bold", hjust = 0.5 ) ) +
  scale_fill_brewer( palette = "Set2" ) +
  theme( legend.position = "none" )
# out of the 85 actors around 78 are white

# distribution of explanatory variable - birthplace
ggplot( data = df, aes( x = birthplace, fill = birthplace ) )  +
  geom_bar() +
  theme_bw() +
  labs( x = '\n Birthplace of Awardees', y = 'Number of Awardees \n',
        title = 'Distribution of Best Actor Awardees by Birthplace (1929-2014)') +
  theme( panel.grid.minor.x = element_blank(), 
         plot.title = element_text( size = 12, face = "bold", hjust = 0.5 ) ) +
  scale_fill_brewer( palette = "Set2" ) +
  theme( legend.position = "none" )
# 30 actors were born outside the US and 55 in the US

# distribution of explanatory variable - sexual orientation
ggplot( data = df, aes( x = sexual_orientation, fill = sexual_orientation ) )  +
  geom_bar() +
  theme_bw() +
  labs( x = '\n Sexual Orientation of Awardees', y = 'Number of Awardees \n',
        title = 'Distribution of Best Actor Awardees by Sexual Orientation (1929-2014)') +
  theme( panel.grid.minor.x = element_blank(), 
         plot.title = element_text( size = 12, face = "bold", hjust = 0.5 ) ) +
  scale_fill_brewer( palette = "Set2" ) +
  theme( legend.position = "none" )
# the majority of actors are straight and the number of homosexuals is very low therefore I merge the homosexual and the bisexual categories

df <- df %>% mutate( sexual_orientation = ifelse( sexual_orientation == 'straight', 'straight', 'not straight' ) )

# distribution of explanatory variable - years since award
ggplot( data = df, aes( x = years_since_award ) ) +
  geom_density( aes( y = ..density..), fill = brewer.pal( 3, "Set2" )[1], alpha = 0.5 ) +
  theme_bw() +
  labs( x='\n Elapsed Years Since Award', y='Kernel Density (Percentage) \n',
       title= 'Distribution of number of elapsed years since award ceremony (1929-2014)' ) +
  theme( panel.grid.minor.x = element_blank(), 
        plot.title = element_text( size = 12, face = "bold", hjust = 0.5 ) )
# the distribution is close to uniform which is correct since there is usually only one awardee in a given year

# distribution of explanatory variable - age at award
ggplot( data = df, aes( x = age_at_award ) ) +
  geom_histogram( aes( y = ..density..), fill = brewer.pal( 3, "Set2" )[2], bins = 25 ) +
  theme_bw() +
  labs( x='\n Age at Award (Years)', y='Relative Frequency \n',
       title= 'Distribution of age when receiving the award (1929-2014)' ) +
  theme( panel.grid.minor.x = element_blank(), 
        plot.title = element_text( size = 12, face = "bold", hjust = 0.5 ) )
# there is one extreme value above 70 
# this makes the distribution a little skewed with a right tail otherwise it would be close to normal

# check which observation the extreme value belongs to
extreme <- df %>% filter( age_at_award > 70 )
# it belongs to Henry Fonda and it is not an error

# if I exclude Henry Fonda then the distribution is close to normal
df %>% filter( age_at_award < 70 ) %>% 
ggplot( aes( x = age_at_award ) ) +
  geom_histogram( aes( y = ..density..), fill = brewer.pal( 3, "Set2" )[2], bins = 20 ) +
  theme_bw() +
  labs( x='\n Age at Award (Years)', y='Relative Frequency \n',
       title= 'Distribution of age when receiving the award below age 70 (1929-2014)' ) +
  theme( panel.grid.minor.x = element_blank(), 
        plot.title = element_text( size = 12, face = "bold", hjust = 0.5 ) )

# but since it is not an error I am not going to drop it

# check if ln transformation would change the skewness
df <- df %>% mutate( age_ln = log( age_at_award ) )

ggplot( data = df, aes( x = age_ln ) ) +
  geom_histogram( aes( y = ..density..), fill = brewer.pal( 3, "Set2" )[2], bins = 25 ) +
  theme_bw() +
  labs( x='\n Ln(Age at Award (Years))', y='Relative Frequency \n',
       title= 'Distribution of ln(age) when receiving the award (1929-2014)' ) +
  theme( panel.grid.minor.x = element_blank(), 
        plot.title = element_text( size = 12, face = "bold", hjust = 0.5 ) )
# the distribution stays almost the same therefore I am not going to use ln transformation for this variable

#### check summary statistics of variables

# summary statistics of dependent variable - race
# first I transform the variable
df <- df %>% mutate( race_b = ifelse( race == 'white', 1, 0 ) )

# then I check the summary statistics
df %>% summarise(
    Variable = 'Race',
    Mean     = mean( race_b ),
    Median   = median( race_b ),
    Std      = sd( race_b ),
    Min      = min( race_b ),
    Max      = max( race_b ),
    N        = n() )

# summary statistics of explanatory variable - birthplace
# first I transform the variable
df <- df %>% mutate( birthplace_b = ifelse( birthplace == 'usa', 1, 0 ) )

# then I check the summary statistics
df %>% summarise(
    Variable = 'Birthplace',
    Mean     = mean( birthplace_b ),
    Median   = median( birthplace_b ),
    Std      = sd( birthplace_b ),
    Min      = min( birthplace_b ),
    Max      = max( birthplace_b ),
    N        = n() )

# summary statistics of explanatory variable - sexual orientation
# first I transform the variable
df <- df %>% mutate( sexual_or_b = ifelse( sexual_orientation == 'straight', 1, 0 ) )

# check summary statistics
df %>% summarise(
    Variable = 'Sexual Orientation',
    Mean     = mean( sexual_or_b ),
    Median   = median( sexual_or_b ),
    Std      = sd( sexual_or_b ),
    Min      = min( sexual_or_b ),
    Max      = max( sexual_or_b ),
    N        = n() )

# summary statistics of explanatory variable - years since award
df %>% summarise(
    Variable = 'Years Since Award',
    Mean     = mean( years_since_award ),
    Median   = median( years_since_award ),
    Std      = sd( years_since_award ),
    Min      = min( years_since_award ),
    Max      = max( years_since_award ),
    N        = n() )

# summary statistics of explanatory variable - age at award
df %>% summarise(
    Variable = 'Age At Award',
    Mean     = mean( age_at_award ),
    Median   = median( age_at_award ),
    Std      = sd( age_at_award ),
    Min      = min( age_at_award ),
    Max      = max( age_at_award ),
    N        = n() )

# no other transformation or scaling is necessary to continue the analysis
```

The sample that I used for the analysis contains 85 observations on Best Actor Awardees between 1929 and 2014. It is important to note that the sample does not have complete coverage since it does not contain data on awardees between 2015 and 2020. Furthermore, it also has selection bias since there is a strong filter on who gets to be nominated for the Best Actor Award. The dependent variable - *race* - is binary and its two possible outcomes are white and not white. There are four explanatory variables in total: *place of birth* which is binary and its two outcomes are USA and not USA, *sexual orientation* which is also binary and its two outcomes are straight and not straight, *elapsed years since awardee got the award* which is quantitative and measured on a ratio scale and lastly *age of awardee on receiving the award* which is also a quantitative, ratio variable. Out of the four explanatory variables *sexual orientation* is likely to have lower reliability since people are not always open about this topic which also means that the variable might suffer from measurement error. However, since my assumption was that it can be an important variable I decided to keep it in the sample.

After creating the workfile I checked the distributions of the variables by using bar charts, histograms and kernel density plots which can be seen below. Based on the bar chart of the *race* variable we can say that the majority of actors are white, in addition by looking at the distribution of the *birthplace* variable we can conclude that most of them were born in the US. As for the *sexual orientation* variable the majority of actors are straight. If we look at the density plot of the *years since award* variable we can see that it approximates a uniform distribution. This is because except for 1930 there was only one awardee in every year. Lastly, the *age at award* variable has one extreme value, however since it is not an error and it is useful to have variation in the explanatory variables I decided to keep this observation. Otherwise, the distribution is a little skewed but since the ln transformation did not bring it closer to normal I opted for no transformation.

```{r, echo=FALSE, warning=FALSE, message=FALSE, out.width='50%'}
#### plot the distributions of variables
# distribution of dependent variable - race
ggplot( data = df, aes( x = race, fill = race ) )  +
  geom_bar() +
  theme_bw() +
  labs( x = '\n Race of Awardees', y = 'Number of Awardees \n',
        title = 'Distribution of Best Actor Awardees by Race (1929-2014)') +
  theme( panel.grid.minor.x = element_blank(), 
         plot.title = element_text( size = 12, face = "bold", hjust = 0.5 ) ) +
  scale_fill_brewer( palette = "Set2" ) +
  theme( legend.position = "none" )

# distribution of explanatory variable - birthplace
ggplot( data = df, aes( x = birthplace, fill = birthplace ) )  +
  geom_bar() +
  theme_bw() +
  labs( x = '\n Birthplace of Awardees', y = 'Number of Awardees \n',
        title = 'Distribution of Best Actor Awardees by Birthplace (1929-2014)') +
  theme( panel.grid.minor.x = element_blank(), 
         plot.title = element_text( size = 12, face = "bold", hjust = 0.5 ) ) +
  scale_fill_brewer( palette = "Set2" ) +
  theme( legend.position = "none" )
```

```{r, echo=FALSE, warning=FALSE, message=FALSE, out.width='50%'}
#### plot the distributions of variables
# distribution of explanatory variable - sexual orientation
ggplot( data = df, aes( x = sexual_orientation, fill = sexual_orientation ) )  +
  geom_bar() +
  theme_bw() +
  labs( x = '\n Sexual Orientation of Awardees', y = 'Number of Awardees \n',
        title = 'Distribution of Best Actor Awardees by Sexual Orientation (1929-2014)') +
  theme( panel.grid.minor.x = element_blank(), 
         plot.title = element_text( size = 12, face = "bold", hjust = 0.5 ) ) +
  scale_fill_brewer( palette = "Set2" ) +
  theme( legend.position = "none" )

# distribution of explanatory variable - years since award
ggplot( data = df, aes( x = years_since_award ) ) +
  geom_density( aes( y = ..density..), fill = brewer.pal( 3, "Set2" )[1], alpha = 0.5 ) +
  theme_bw() +
  labs( x='\n Elapsed Years Since Award', y='Kernel Density (Percentage) \n',
       title= 'Distribution of number of elapsed years since award ceremony (1929-2014)' ) +
  theme( panel.grid.minor.x = element_blank(), 
        plot.title = element_text( size = 12, face = "bold", hjust = 0.5 ) )
```

```{r, echo=FALSE, warning=FALSE, message=FALSE, out.width='50%', fig.align='center'}
#### plot the distributions of variables
# distribution of explanatory variable - age at award
ggplot( data = df, aes( x = age_at_award ) ) +
  geom_histogram( aes( y = ..density..), fill = brewer.pal( 3, "Set2" )[2], bins = 25 ) +
  theme_bw() +
  labs( x='\n Age at Award (Years)', y='Relative Frequency \n',
       title= 'Distribution of age when receiving the award (1929-2014)' ) +
  theme( panel.grid.minor.x = element_blank(), 
        plot.title = element_text( size = 12, face = "bold", hjust = 0.5 ) )
```

Besides the plots I also checked the descriptive statistics of the variables which can be seen in the table below. The means of the *race*, *birthplace* and *sexual orientation* variables show that the majority of actors are white, were born in the US and straight. We can see that the first award was given out 92 years ago and that actors are usually between their late thirties and early fifties when receiving the award.

\newpage

```{r, echo=FALSE, warning=FALSE, message=FALSE}
#### summary statistics table

# race
race_stat <- df %>% summarise(
    Variable = 'Race',
    Mean     = mean( race_b ),
    Median   = median( race_b ),
    Std      = sd( race_b ),
    Min      = min( race_b ),
    Max      = max( race_b ),
    N        = n() )

# birthplace
birthplace_stat <- df %>% summarise(
    Variable = 'Birthplace',
    Mean     = mean( birthplace_b ),
    Median   = median( birthplace_b ),
    Std      = sd( birthplace_b ),
    Min      = min( birthplace_b ),
    Max      = max( birthplace_b ),
    N        = n() )

# sexual orientation
sexual_o_stat <- df %>% summarise(
    Variable = 'Sexual Orientation',
    Mean     = mean( sexual_or_b ),
    Median   = median( sexual_or_b ),
    Std      = sd( sexual_or_b ),
    Min      = min( sexual_or_b ),
    Max      = max( sexual_or_b ),
    N        = n() )

# years since award
years_stat <- df %>% summarise(
    Variable = 'Years Since Award',
    Mean     = mean( years_since_award ),
    Median   = median( years_since_award ),
    Std      = sd( years_since_award ),
    Min      = min( years_since_award ),
    Max      = max( years_since_award ),
    N        = n() )

# age at award
age_stat <- df %>% summarise(
    Variable = 'Age At Award',
    Mean     = mean( age_at_award ),
    Median   = median( age_at_award ),
    Std      = sd( age_at_award ),
    Min      = min( age_at_award ),
    Max      = max( age_at_award ),
    N        = n() )

# merge tables
table_summary <- NULL
table_summary <- rbind(   race_stat,
                          birthplace_stat,
                          sexual_o_stat,
                          years_stat,
                          age_stat )

# print table
knitr::kable( table_summary, caption = "Descriptive statistics of variables", digits = 2 ) %>% kable_styling( position = "center", latex_options = 'hold_position' )
```

## Model

To find the answer to my research question first I inspected the pattern of association between the dependent variable and the quantitative explanatory variables (see Appendix). Based on the relationship check I decided to include the *years since award* variable in a linear way, whereas the *age at award* variable was included with a piecewise linear spline at age 47. Furthermore, I created an interaction between the *birthplace* and the *years since award* variables since I assumed that if an actor got the award a long time ago and was even born in the US then that would increase the probability of him being white.

In total I estimated five different models, three linear probability models, one logit and one probit model. After running the models I had to conclude that none of the parameters proved to be significant in my best three models (see Appendix). This was probably due to not having enough variation in my qualitative explanatory variables as well as the size of the sample.

According to the log likelihood value the logit model was slightly better than the probit model, therefore I only show the formula - where lambda indicates the link function - for this model without the parameter estimates since those were not significant.

\begin{equation}
\begin{split}
y^p & = \Lambda( \beta_0 + \beta_1birthplace_i + \beta_2sexual.orientation_i + \beta_3years.since.award_i + \beta_4age.at.award(<47)_i + \\
& \beta_5age.at.award(> 47)_i + \beta_6birthplace*years.since.award_i ) \nonumber 
\end{split}
\end{equation}

```{r, include=FALSE}
#### run linear probability models
# linear probability model without PLS
lpm1 <- lm( race_b ~ birthplace_b + sexual_or_b + years_since_award + age_at_award, data = df )

summary( lpm1, vcov=sandwich )
# all variables are non-significant

# check VIF values
vif( lpm1 )
# all of them are around one which means that multicollinearity is weak

# linear probability model with PLS for age_at_award
lpm2 <- lm( race_b ~ birthplace_b + sexual_or_b + years_since_award  + lspline( age_at_award, c( 47 ) ), data = df )

summary( lpm2, vcov=sandwich )
# there is one significant parameter which belongs to age_at_award above 47 years

# check VIF values
vif( lpm2 )
# all of them are around one which means that multicollinearity is weak

# linear probability model with PLS for age_at_award and interaction for birthplace and years_since_award
# create interaction variable
df <- df %>% mutate( birth_years = birthplace_b * years_since_award )

lpm3 <- lm( race_b ~ birthplace_b + sexual_or_b + years_since_award  + lspline( age_at_award, c( 47 ) ) +  birth_years, data = df )

summary( lpm3, vcov=sandwich )

# get predicted values
df$pred_lpm3 <- predict( lpm3 )
  
# descriptive summary of the predictions
summary( df$pred_lpm3 )
# the probabilities are high, their range is between 0.71 and 1.17
```

```{r, include=FALSE}
#### run logit and probit models
# create a formula variable
model_formula <- formula( race_b ~ birthplace_b + sexual_or_b + years_since_award  + lspline( age_at_award, c( 47 ) ) +  birth_years )

## logit model
logit <- glm( model_formula , data = df, family = binomial( link = "logit" ) )
summary( logit )
# no parameters are significant

# calculate predicted probabilities 
df$pred_logit <- predict.glm( logit, type = "response" )
summary( df$pred_logit )

# calculate marginal differences
logit_marg <- logitmfx( model_formula, data = df, atmean=FALSE, robust = T )
print( logit_marg )

## probit model
probit <- glm( model_formula , data = df, family = binomial( link = "probit" ) )
summary( probit )
# no parameters are significant

# calculate predicted probabilities 
df$pred_probit <- predict.glm( probit, type = "response" )
summary( df$pred_probit )

# calculate marginal differences
probit_marg <- probitmfx( model_formula, data = df, atmean=FALSE, robust = T )
print( probit_marg )
```

To show that the logit model is not suitable for prediction I created a calibration curve which displays the goodness of fit of a model. The chart can be seen below. Since the orange line which indicates the predicted probabilities does not overlap with the green line showing the actual probabilities we can conclude that the model is not well calibrated at all.

```{r, echo=FALSE, message=FALSE, warning=FALSE, fig.align='center'}
#### create calibration curve
# create new data frame
actual_vs_predicted <- df %>%
  ungroup() %>% 
  dplyr::select( actual = race_b, 
                predicted = pred_logit ) 
num_groups <- 10

# group observations
calibration_d <- actual_vs_predicted %>%
  mutate(predicted_score_group = dplyr::ntile(predicted, num_groups))%>%
  group_by(predicted_score_group) %>%
  dplyr::summarise(mean_actual = mean(actual), 
                   mean_predicted = mean(predicted), 
                   num_obs = n())

# plot the curve
ggplot( calibration_d,aes(x = mean_actual, y = mean_predicted)) +
  theme_bw() +
  geom_point( color=brewer.pal( 3, "Set2" )[2], size=1.5, alpha=0.8) +
  geom_line(  color=brewer.pal( 3, "Set2" )[2], size=1  , alpha=0.8) +
  geom_abline( intercept = 0, slope = 1, color=brewer.pal( 3, "Set2" )[1]) +
  labs( x = "\n Actual event probability", y = "Predicted event probability \n", title = "Calibration curve for logit model") +
  scale_x_continuous(expand = c(0.01,0.01), limits = c(0,1), breaks = seq(0,1,0.1)) +
  scale_y_continuous(expand = c(0.01,0.01), limits = c(0,1), breaks = seq(0,1,0.1)) +
  theme( plot.title = element_text( size = 12, face = "bold", hjust = 0.5 ) )
```

Since it could have happened that I did not add some important variables that could have made the parameter estimates better I decided to do a robustness check for the logit model. To do this I estimated two additional logit models: one without the interaction variable and one with two knots for the *age at award* variable which was supported by the lowess graph between the *race* and the *age at award* variables. The comparison table of these two models and the original logit model can be seen below. Since all of the parameters are non-significant for the new models as well I concluded that the model is robust.

\newpage

```{r, include=FALSE}
#### robustness check with the logit model
# run logit model with two knots for the age at award variable
logit_2_knots <- glm( race_b ~ birthplace_b + sexual_or_b + years_since_award  + lspline( age_at_award, c( 47, 56 ) ) +  birth_years, data = df, family = binomial( link = "logit" ) )

# run logit model without the birthplace*years since award interaction and one knot
logit_no_inter <- glm( race_b ~ birthplace_b + sexual_or_b + years_since_award  + lspline( age_at_award, c( 47 ) ), data = df, family = binomial( link = "logit" ) )
```

```{r, echo=FALSE, warning=FALSE, message=FALSE}
# create summary table
# create list of pretty model names
models <- list()
models[[ "Logit Orig." ]] <- logit
models[[ "Logit with Two Knots" ]] <- logit_2_knots
models[[ "Logit without Interaction" ]] <- logit_no_inter

# create list of variable names
coef_names <- c( '(Intercept)' = 'Constant',
          "birthplace_b" = 'Birthplace',
         "sexual_or_b" = "Sexual Orientation",
         "years_since_award" = "Years Since Award",
         "age_at_award" = "Age At Award",
         "lspline(age_at_award, c(47))1" = "Age At Award (< 47)",
         "lspline(age_at_award, c(47))2" = "Age At Award (> 47)",
         "birth_years" = "Birthplace * Years Since Award",
         "lspline(age_at_award, c(47, 56))1" = "Age At Award (< 47)'",
         "lspline(age_at_award, c(47, 56))2" = "Age At Award (> 47 & < 56)",
         "lspline(age_at_award, c(47, 56))3" = "Age At Award (> 56)" )

# add pseudo R2
glance_custom.glm <- function(x) data.frame(`Pseudo R2` = pR2(x)["McFadden"])

# create table
msummary( models,
          fmt="%.2f",
          gof_omit = 'DF|Deviance|F|R2 Adj.|AIC',
          stars = c('*' = .05, '**' = .01),
          coef_rename = coef_names,
          output = "latex",
          title = 'Robustness check with two additional logit models'
)
```

## External validity

Discrimination against race is said to be present in every award category at the Academy Awards therefore I ran the original logit model on three additional samples: Best Supporting Actor Awardees, Best Actress Awardees and Best Director Awardees. This way I could check if my findings had high or low external validity for other categories.

The comparison table below displays the results of the original logit model for Best Actor Awardees and the three additional ones mentioned above.

```{r, include=FALSE}
#### robustness check and external validity
# import data
github_url_2 <- 'https://raw.githubusercontent.com/sulekata/Coding_1/master/Term_Project/data/clean/all_awardees.csv'

df2 <- read_csv( github_url_2 )

# drop observations with missing values
missing <- df2 %>% filter( grepl('na', race ) | grepl( 'na', birthplace ) | grepl( 'na', sexual_orientation ) | grepl( 'na', years_since_award ) | grepl( 'na', age_at_award ) )

df2 <- df2 %>% filter( !grepl( 'na', sexual_orientation ) )

# create numeric binary race variable
df2 <- df2 %>% mutate( race_b = ifelse( race == 'white', 1, 0 ) )

# merge homosexual and bisexual categories and create numeric binary variable
df2 <- df2 %>% mutate( sexual_orientation = ifelse( sexual_orientation == 'straight', 'straight', 'not straight' ) )

df2 <- df2 %>% mutate( sexual_or_b = ifelse( sexual_orientation == 'straight', 1, 0 ) )

# create numeric binary birthplace variable
df2 <- df2 %>% mutate( birthplace_b = ifelse( birthplace == 'usa', 1, 0 ) )

# create interaction variable
df2 <- df2 %>% mutate( birth_years = birthplace_b * years_since_award )

# create df for Best Supporting Actor
df_sup <- df2 %>% filter( award == 'Best Supporting Actor' )

# create df for Best Actress
df_actress <- df2 %>% filter( award == 'Best Actress' )

# create df for Best Director
df_dir <- df2 %>% filter( award == 'Best Director' )
```

```{r, include=FALSE}
#### run logit model for these data frames
# best supporting actor
logit_sup <- glm( model_formula , data = df_sup, family = binomial( link = "logit" ) )

# best actress
logit_actress <- glm( model_formula , data = df_actress, family = binomial( link = "logit" ) )

# best director
logit_dir <- glm( model_formula , data = df_dir, family = binomial( link = "logit" ) )
```

\newpage

```{r, results = 'asis', echo = FALSE, message=FALSE, warning=FALSE}
#### create comparison table with original logit model included as well
# create list of pretty model names
models <- list()
models[[ "Actor" ]] <- logit
models[[ "Supp. Actor" ]] <- logit_sup
models[[ "Actress" ]] <- logit_actress
models[[ "Director" ]] <- logit_dir

# create list of variable names
coef_names <- c( '(Intercept)' = 'Constant',
          "birthplace_b" = 'Birthplace',
         "sexual_or_b" = "Sexual Orientation",
         "years_since_award" = "Years Since Award",
         "lspline(age_at_award, c(47))1" = "Age At Award (< 47)",
         "lspline(age_at_award, c(47))2" = "Age At Award (> 47)",
         "birth_years" = "Birthplace * Years Since Award" )

# add pseudo R2
glance_custom.glm <- function(x) data.frame(`Pseudo R2` = pR2(x)["McFadden"])

# create table
msummary( models,
          fmt="%.3f",
          gof_omit = 'DF|Deviance|F|R2 Adj.|AIC|Log.Lik.',
          stars = c('*' = .05, '**' = .01),
          coef_rename = coef_names,
          output = "latex",
          title = 'External validity check on three new samples'
)
```

Based on the comparison table we can see that the coefficient estimates are similar to the original ones except for the sample of directors where they tend to be much higher. However, what is important is that none of the parameters are significant therefore I can conclude that the results of the original model do not have external validity for the Best Supporting Actor, Best Actress and Best Director categories. This suggest that the insignificant results of the original model are probably due to the used variables and not the sample size.

## Summary

In this analysis I investigated whether Best Actor Awardees at the Academy Awards are more likely to be white with the help of probability models. I estimated linear probability models, a logit and a probit model with race being the dependent variable and four explanatory variables. Based on the results I had to conclude that none of the parameters of my models were significant therefore they are not suitable for prediction purposes. Furthermore, by checking the external validity of the model I saw that the insignificant results were probably caused by inadequate variables and not small sample size. Which means that the place of birth, the sexual orientation, the elapsed years since receiving the award and the age at award are not suitable to predict the race of an awardee.

\newpage

## Appendix

### Inspection of pattern of association

To be able to decide about which functional form would be the best for the quantitative explanatory variables in the estimation I created a graph with lowess for each of them. Based on these I concluded that there is a linear relationship between the *race* and the *years since award* variables, whereas for the *age at award* there seems to be a knot at 47 years and one at 56 years.

```{r, echo=FALSE, warning=FALSE, message=FALSE, out.width='50%'}
#### check pattern of association between y and continuous x variables
# race vs years_since_award
ggplot( data = df, aes( x = years_since_award, y = race_b ) ) +
  geom_smooth( method = "loess", se=F, color = brewer.pal( 3, "Set2" )[1], size = 1.5 ) +
  scale_y_continuous( expand = c( 0.01,0.01 ), limits = c(0,1), breaks = seq(0,1,0.2), labels = scales::percent ) +
  theme_bw() +
  labs( x = "\n Elapsed Years Since Award", y = "Probability of Being White \n", title = "Pattern of association between race and years since award") +
  theme( plot.title = element_text( size = 12, face = "bold", hjust = 0.5 ) )
# this association seems to be linear

# race vs age_at_award
ggplot( data = df, aes( x = age_at_award, y = race_b ) ) +
  geom_smooth( method = "loess", se=F, color = brewer.pal( 3, "Set2" )[1], size = 1.5 ) +
  scale_y_continuous( expand = c( 0.01,0.01 ), limits = c(0,1), breaks = seq(0,1,0.2), labels = scales::percent ) +
  theme_bw() +
  labs( x = "\n Age At Award (Years)", y = "Probability of Being White \n", title = "Pattern of association between race and age at award") +
  theme( plot.title = element_text( size = 12, face = "bold", hjust = 0.5 ) )
# seems like there is a knot at 47 years
```

### Models and their characteristics

Since my models did not have significant parameters most of this section aims to show what kind of insights we can get from probability models given that they are significant.

#### Estimated models

The model comparison table below shows the coefficients and the marginal effects - if applicable - of the best three models. None of the coefficient are significant, however since the logit model is a bit better than the probit according to the log likelihood value I decided to use this model to show how we can evaluate probability models in the upcoming sections.

```{r, results = 'hide', echo = FALSE, message=FALSE, warning=FALSE, error = FALSE}
# create comparison table for lpm, logit and probit models with marginal effects
# create list of pretty model names
models <- list()
models[[ "LPM + PLS" ]] <- lpm2
models[[ "LPM + PLS + Int." ]] <- lpm3
models[[ "Logit" ]] <- logit
models[[ "Logit Mfx" ]] <- logit_marg
models[[ "Probit" ]] <- probit
models[[ "Probit Mfx" ]] <- probit_marg

# create list of variable names
coef_names <- c( '(Intercept)' = 'Constant',
          "birthplace_b" = 'Birthplace',
         "sexual_or_b" = "Sexual Orientation",
         "years_since_award" = "Years Since Award",
         "age_at_award" = "Age At Award",
         "lspline(age_at_award, c(47))1" = "Age At Award (< 47)",
         "lspline(age_at_award, c(47))2" = "Age At Award (> 47)",
         "birth_years" = "Birthplace * Years Since Award")

# add pseudo R2
glance_custom.glm <- function(x) data.frame(`Pseudo R2` = pR2(x)["McFadden"])
```

```{r, results = 'asis', echo = FALSE, message=FALSE, warning=FALSE, fig.align="center"}
# create table
msummary( models,
          fmt="%.2f",
          gof_omit = 'DF|Deviance|F|R2 Adj.|AIC',
          stars = c('*' = .05, '**' = .01),
          coef_rename = coef_names,
          output = "latex",
          title = 'Results of estimated models'
)
```

\newpage

#### Predicted probabilities

The histogram below aims to show that the predicted probabilities of the linear probability model can be higher than 1 which makes it unsuitable for prediction purposes. However, it is visible that the probability of an actor being white is relatively high throughout the sample.

```{r, echo=FALSE, warning=FALSE, message=FALSE, fig.align='center'}
# distribution of predicted probabilities for the lpm3 model
ggplot( df, aes( x = pred_lpm3 ) ) +
  geom_histogram( fill = brewer.pal( 3, "Set2" )[1], color = brewer.pal( 3, "Set2" )[3] ) + theme_bw() +
  labs( x = "\n Predicted Probabilities", y = "Absolute Frequency \n", title = "Distribution of predicted probabilities of the LPM model") +
  theme( plot.title = element_text( size = 12, face = "bold", hjust = 0.5 ) )
```

This chart shows how the predicted probabilities of the three models are related to each other. We can see that the predictions of the logit and probit models are very close to each other, however they both differ a lot from the linear probability model. The chart also shows that the probit and the logit models do not predict probabilities above 1, unlike the linear probability model.

```{r, echo=FALSE, warning=FALSE, message=FALSE, fig.align='center'}
# compare predicted probabilities of logit and probit to LPM
ggplot( df ) +
  geom_point( aes( x = pred_lpm3, y = pred_probit, color = 'Probit'), size = 1, shape = 16 ) +
  geom_point( aes( x = pred_lpm3, y = pred_logit, color = 'Logit'), size = 1, shape = 16 ) +
  geom_line( aes( x = pred_lpm3, y = pred_lpm3, color = '45 degree line'), size = 1 ) +
  scale_color_brewer( palette = "Set2" ) +
  theme_bw() +
  labs( x = "\n Predicted Probability of Being White (LPM)", y = "Predicted Probability \n", title = "Predicted probabilities for the LPM, Logit and Probit models") +
  theme( plot.title = element_text( size = 12, face = "bold", hjust = 0.5 ), legend.title=element_blank() )
  
```

These two tables show the characteristics of actors who belong to the bottom and top 10% based on the predicted probabilities by the logit model. We can see that actors who are in the bottom 10% - meaning that their probability of being white is the lowest - were born in the US, are straight, received the award 19 years ago on average and were generally 44 years old when receiving it. As for the top 10% in comparison, 88% of actors were born in the US, 75% of them is straight, received the award much longer ago, 73 years on average, and were also older on average when receiving it.

```{r, echo=FALSE, warning=FALSE, message=FALSE}
# check characteristics of top and bottom 10% for the logit model
# create bins to categorize the predicted values between 1-10
df <- df %>% 
  mutate( q100_pred_logit = ntile( pred_logit, 10 ) )

# create summary statistics using the sum_stat function from class
# bottom 10%
b10 <- sum_stat( subset( df, q100_pred_logit == 1 ), 
          c( 'birthplace_b', 'sexual_or_b', 'years_since_award', 'age_at_award' ),
          c( 'mean','median','sd' ), num_obs = F )

# change column names
b10 <- b10 %>% rename( Statistics = statistics,
                       Birthplace = birthplace_b,
                      `Sexual Orientation` = sexual_or_b,
                      `Years Since Award` = years_since_award,
                      `Age At Award` = age_at_award ) 

# print table
knitr::kable( b10, caption = "Characteristics of bottom 10% (Logit)", digits = 2, format = "latex" ) %>% kable_styling( position = "center", latex_options = 'hold_position' )
```

```{r, echo=FALSE, warning=FALSE, message=FALSE}
# top 10%
t10 <- sum_stat( subset( df, q100_pred_logit == 10 ),
                c( 'birthplace_b', 'sexual_or_b', 'years_since_award', 'age_at_award' ),
                c( 'mean','median','sd' ), num_obs = F )

# change column names
t10 <- t10 %>% rename( Statistics = statistics,
                       Birthplace = birthplace_b,
                      `Sexual Orientation` = sexual_or_b,
                      `Years Since Award` = years_since_award,
                      `Age At Award` = age_at_award ) 

# print table
knitr::kable( t10, caption = "Characteristics of top 10% (Logit)", digits = 2 ) %>% kable_styling( position = "center", latex_options = 'hold_position' )
```

#### Conditional predicted probabilities

The purpose of this histogram is to show the distribution of probabilities predicted by the logit model conditional on the race variable. We can see that the predictions for the two groups overlap and that the model sometimes predicts low probabilities for actors who are actually white and that it also predicts high probabilities for actors who are not white. This proves that the model is not really suitable for prediction.

```{r, echo=FALSE, warning=FALSE, message=FALSE, fig.align='center'}
#### distribution of predicted probabilities by outcome
# logit model
ggplot( data = df, aes( x = pred_logit ) ) + 
  theme_bw() +
  geom_histogram( data = subset( df[df$race_b == 1, ] ), 
                 aes( fill = as.factor( race_b ), color = as.factor( race_b ), y = (..count..)/sum(..count..)*100 ), binwidth = 0.05, boundary=0, alpha=0.8 ) +
  geom_histogram( data = subset( df[df$race_b == 0, ] ), 
                 aes( fill = as.factor( race_b ), color = as.factor( race_b ), y = (..count..)/sum(..count..)*100), binwidth = 0.05, boundary=0, alpha=0 ) +
  scale_fill_manual( name="", values=c("0" = "white", "1" = brewer.pal( 3, "Set2" )[1]),labels=c("Not White","White")) +
  scale_color_manual( name="", values=c("0" = brewer.pal( 3, "Set2" )[2], "1" = brewer.pal( 3, "Set2" )[1]),labels=c("Not White","White")) +
  ylab("Percent") +
  xlab("Fitted values") +
  labs( title = "Distribution of Conditional Predicted Probabilities (Logit)" ) +
  scale_x_continuous(expand=c(0.01,0.01) ,limits = c(0.3,1), breaks = seq(0,1,0.1)) +
  theme( plot.title = element_text( size = 12, face = "bold", hjust = 0.5 ) )
```

The two tables below show the conditional probabilities predicted by the three models. For white actors we can see that the biggest difference between the models are in their minimums. The linear probability model has a minimum of 0.71, while the logit and the probit models have theirs at 0.43 and 0.48. As for non-white actors the pattern is very similar with the minimums differing the most, however in this case the standard deviation is also higher for the logit and the probit models.

```{r, echo=FALSE, message=FALSE, warning=FALSE}
#### summary statistics of predicted probabilities conditional on race
# if race is white
cond_white <- sum_stat( subset( df, race_b == 1 ), c("pred_lpm3", "pred_logit", "pred_probit"), 
          c( "mean","median","min","max","sd" ),
          num_obs = F )

# change column names
cond_white <- cond_white %>% rename( Statistics = statistics,
                       LPM = pred_lpm3,
                       Logit = pred_logit,
                       Probit = pred_probit ) 

# print table
knitr::kable( cond_white, caption = "Summary statistics of predicted probabilities if race is white", digits = 2 ) %>% kable_styling( position = "center", latex_options = 'hold_position' )
```

```{r, echo=FALSE, warning=FALSE, message=FALSE}
# if race is not white
cond_not_white <- sum_stat( subset( df, race_b == 0 ), c("pred_lpm3", "pred_logit", "pred_probit"), 
          c( "mean","median","min","max","sd" ),
          num_obs = F )

# change column names
cond_not_white <- cond_not_white %>% rename( Statistics = statistics,
                       LPM = pred_lpm3,
                       Logit = pred_logit,
                       Probit = pred_probit ) 

# print table
knitr::kable( cond_not_white, caption = "Summary statistics of predicted probabilities if race is not white", digits = 2 ) %>% kable_styling( position = "center" )
```

